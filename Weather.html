<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Météo</title>
    <link rel="stylesheet" href="style.css" />  
</head>
<body>
  <h1>Météo du jour</h1>
  <input type="text" id="ville" placeholder="Entrez une ville" />
  <button onclick="obtenirMeteo()">Rechercher</button>
  <div id="resultat"></div>

  <script>
    const apiKey = "281eec27318c19122b887f323200a827"; // remplace par ta vraie clé OpenWeather (One Call 3.0 activée)

    async function obtenirMeteo() {
      const ville = document.getElementById("ville").value;
      const resultat = document.getElementById("resultat");
      resultat.innerHTML = "Chargement...";

      try {
        // 1. Obtenir les coordonnées de la ville
        const geoRes = await fetch(`https://api.openweathermap.org/geo/1.0/direct?q=${ville}&limit=1&appid=${apiKey}`);
        const geoData = await geoRes.json();
        if (geoData.length === 0) throw new Error("Ville introuvable");

        const { lat, lon, name } = geoData[0];

        // 2. Obtenir les infos météo détaillées (One Call API 3.0)
        const meteoRes = await fetch(`https://api.openweathermap.org/data/3.0/onecall?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric&lang=fr&exclude=minutely,hourly`);
        const meteoData = await meteoRes.json();

        const today = meteoData.daily[0]; // météo du jour
        const tempMin = today.temp.min;
        const tempMax = today.temp.max;
        const vent = meteoData.current.wind_speed;
        const orientationVent = meteoData.current.wind_deg;
        const uv = meteoData.current.uvi;
        const pluie = today.rain || 0; // mm de précipitation
        const ensoleillement = today.sunset && today.sunrise ? ((today.sunset - today.sunrise) / 3600).toFixed(1) : "?";

        const orientation = degToCardinal(orientationVent);

        resultat.innerHTML = `
          <h2>Météo à ${name}</h2>
          <ul>
            <li><strong>Temp. min :</strong> ${tempMin} °C</li>
            <li><strong>Temp. max :</strong> ${tempMax} °C</li>
            <li><strong>Vent :</strong> ${vent} km/h (${orientation})</li>
            <li><strong>Indice UV :</strong> ${uv}</li>
            <li><strong>Précipitations :</strong> ${pluie} mm</li>
            <li><strong>Ensoleillement :</strong> ${ensoleillement} h</li>
          </ul>
        `;
      } catch (err) {
        resultat.innerHTML = "Erreur : " + err.message;
      }
    }

    function degToCardinal(deg) {
      const directions = ["N", "NE", "E", "SE", "S", "SO", "O", "NO"];
      return directions[Math.round(deg / 45) % 8];
    }
  </script>
</body>
</html>
